[
  {
    "name": "WindDirection",
    "release": "1.0",
    "active": true,
    "description": "",
    "initialize": "/*\r\n  サーキットマップの上が北でない場合は設定\r\n  表示されるサーキットマップの北の方角を上を0°として反時計回りにdegreeで指定する。\r\n  例えば、左が北の場合は90、右が北の場合は270(-90)。\r\n*/\r\nthis.trackInfos = {\r\n  // デフォルト0なので列挙不要だが、調査済ということで記録しておく（1サーキット１コース）\r\n  229: 0, // cota gp\r\n  179: 0, // long beach\r\n  250: 0, // nuerburg gp\r\n  252: 0, // nuerburg gp nos 24h\r\n  95: 0, // sebring international\r\n  298: 0, // snetterton 300\r\n  168: 0, // suzuka gp\r\n  390: 0, // hockenheim gp\r\n  403: 0, // spielberg gp\r\n  46: 134, // barber full\r\n  99: 134, // barber short a\r\n  100: 134, // barber short b\r\n  347: -60, // barcelona club\r\n  345: -60, // barcelona gp\r\n  349: -60, // barcelona historic\r\n  348: -60, // barcelona moto\r\n  346: -60, // barcelona national\r\n  319: -15, // belleisle\r\n  145: 23, // brands hatch gp\r\n  146: 23, // brands hatch indy\r\n  21: 154, // homestead miami road a\r\n  22: 154, // homestead miami road b\r\n  38: 105, // charlotte 2016 infield road\r\n  37: 105, // charlotte 2016 road\r\n  336: 105, // charlotte 2018 legends rc long\r\n  337: 105, // charlotte 2018 legends rc medium\r\n  338: 105, // charlotte 2018 legends rc short\r\n  340: 105, // charlotte 2018 legends roval long\r\n  330: 105, // charlotte 2018 roval\r\n  350: 105, // charlotte roval\r\n  405: -90, // chicago\r\n  233: -175, // donington gp\r\n  234: -175, // donington national\r\n  192: 125, // daytona road\r\n  166: 85, // okayama full\r\n  167: 85, // okayama short\r\n  163: 230, // spa gp\r\n  164: 230, // spa classic\r\n  165: 230, // spa endurance\r\n  268: 87, // le mans\r\n  269: 87, // le mans historic\r\n  444: -24, // fuji gp\r\n  445: -24, // fuji nochicane\r\n  266: -168, // imola gp\r\n  267: -168, // imola moto\r\n  212: -75, // interlagos gp\r\n  213: -75, // interlagos moto\r\n  47: 116, // laguna seca\r\n  158: 116, // laguna seca school\r\n  34: -156, // lime rock park chicane\r\n  1: -156, // lime rock park full\r\n  160: -156, // lime rock park school\r\n  353: -156, // lime rock 2019 gp\r\n  354: -156, // lime rock 2019 chicanes\r\n  355: -156, // lime rock 2019 westbend\r\n  352: -156, // limerock 2019 classic\r\n  154: -42, // midohio chicane\r\n  153: -42, // midohio full\r\n  155: -42, // midohio short\r\n  218: 98, // montreal\r\n  239: 96, // monza gp\r\n  240: 96, // monza comb no chic\r\n  242: 96, // monza gp no chic\r\n  244: 96, // monza gp no first chic\r\n  246: 96, // monza comb no first chic\r\n  247: 96, // monza comb\r\n  144: -116, //mosport\r\n  196: 25, // motegi east\r\n  195: 25, // motegi gp\r\n  197: 25, // motegi west\r\n  219: -40, // mount panorama\r\n  202: -21, // oran park gp\r\n  211: -21, // oran park moto\r\n  207: -21, // oran park north\r\n  209: -21, // oran park north a\r\n  210: -21, // oran park north b\r\n  208: -21, // oran park south\r\n  181: 85, // oulton park fosters\r\n  186: 85, // oulton park fosters hislop\r\n  183: 85, // oulton park int brittens\r\n  184: 85, // oulton park int hislop\r\n  185: 85, // oulton park int no chicanes\r\n  180: 85, // oulton park international\r\n  182: 85, // oulton park island\r\n  187: 85, // oulton park island historic\r\n  152: 85, // phillip island\r\n  105: 160, // phoenix 08 road\r\n  50: -90, // road america bend\r\n  18: -90, // road america full\r\n  126: -93, // road atlanta club\r\n  127: -93, // road atlanta full\r\n  128: -93, // road atlanta short\r\n  41: 83, // silverstone 2011 gp\r\n  48: -142, // sonoma cup\r\n  102: -142, // sonoma irl\r\n  49: -142, // sonoma irl 07\r\n  98: -142, // sonoma long\r\n  8: -70, // summit point jefferson\r\n  142: -70, // summit point jefferson reverse\r\n  9: -72, // summit point raceway\r\n  159: -72, // summit point school\r\n  24: -72, // summit point short\r\n  329: -65, // tsukuba 1000 chicane\r\n  328: -65, // tsukuba 1000 outer\r\n  327: -65, // tsukuba 1000 full\r\n  333: -65, // tsukuba 1000 full reverse\r\n  324: -65, // tsukuba 2000 full\r\n  325: -65, // tsukuba 2000 chicane\r\n  326: -65, // tsukuba 2000 short\r\n  465: 101, // vir full\r\n  6: 101, // vir grand east\r\n  466: 101, // vir grand west\r\n  467: 101, // vir north\r\n  469: 101, // vir patriot\r\n  141: 101, // vir patriot reverse\r\n  468: 101, // vir south\r\n  147: -12, // zandvoort chicane\r\n  149: -12, // zandvoort gp\r\n  148: -68, // zandvoort club\r\n  150: -68, // zandvoort national\r\n  199: -35, // zolder gp\r\n  413: 38, // hungaroring\r\n  423: 7, // knockhill international\r\n  424: 7, // knockhill internationalrev\r\n  425: 7, // knockhill national\r\n  426: 7, // knockhill nationalrev\r\n  439: 59, // winton national\r\n  440: 59, // winton club\r\n  443: 90, // sandown\r\n  449: 0, // oschersleben gp\r\n  451: -83, // rudskogen\r\n  463: 90, // magnycours gp\r\n  473: 0, // jerez gp\r\n  106: 94, // watkins glen cup\r\n  107: 94, // watkins glen boot\r\n  108: 94, // watkins glen classic boot\r\n  433: 94, // watkinsglen 2021 cupcircuit\r\n  434: 94, // watkinsglen 2021 fullcourse\r\n  435: 94, // watkinsglen 2021 fullnoloop\r\n  109: 94, // watkins glen classic\r\n  432: 94  // watkinsglen 2021 classic\r\n}\r\n\r\nconst winDirWrapperName = 'wind-dir-wrapper';\r\nconst winVelocityName = 'wind-velocity';\r\n\r\nthis.trackMapElem = document.getElementById('trackMap');\r\nthis.windDirWrapperElem = document.createElement('div');\r\nthis.windDirWrapperElem.id = winDirWrapperName;\r\nthis.windDirWrapperElem.classList.add(winDirWrapperName);\r\n\r\nthis.trackMapElem.appendChild(this.windDirWrapperElem);\r\n\r\nconst svgHtml = `\r\n<svg id='wind-dir' class='wind-dir' viewBox='70, 45, 65, 118' xmlns='http://www.w3.org/2000/svg'>\r\n  <g  stroke='#333333' stroke-linecap='round' fill='none' stroke-width='4' class='wind-dir-parts'>\r\n      <path d='M 100 50 v 75 c 0 8.28, 6.72 15, 15 15 c 8.28 0, 15 -6.72, 15 -15 c 0 -8.28, -5.72 -11, -7.5 -13'></path>\r\n      <path d='M 94 74 v 40 c 0 15, -20 15, -20 0 c 0 -5, 5 -8, 10 -10'></path>\r\n      <path d='M 106 68 v 30 c 0 15, 20 15, 20 0 c 0 -5, -5 -8, -10 -10'></path>\r\n  </g>\r\n</svg>\r\n<div class='${winVelocityName}'><span>0 m/s</span></div>\r\n`;\r\n\r\nthis.windDirWrapperElem.innerHTML = svgHtml;\r\n\r\nthis.setAngle = (value) => {\r\n  varElem.style.setProperty('--win-dir-rotate', `${value}deg`);\r\n  this.angle = value;\r\n}\r\n\r\n/* 風の強さによって色相を変える\r\n    0m/s～12m/s\r\n    hsl(h, s, l)\r\n\r\n    h: シアン(180°)～赤(0°)\r\n    s: 195=76%\r\n    l: 140=55%\r\n\r\n    色相計算: (180/12)x + 180\r\n    y = -15x + 180\r\n */\r\nthis.setTrackWindVelocity = (value) => {\r\n  const h = -15 * value + 180;\r\n  varElem.style.setProperty('--wind-dir-color-h', `${h}deg`);\r\n  winVelocityElem.innerText = `${value} m/s`;\r\n  this.trackWindVelocity = value;\r\n}\r\n\r\n/* ラッパにhideクラスを付与してCSSで非表示にする */\r\nthis.hideMe = () => {\r\n  this.windDirWrapperElem.classList.add('hide');\r\n}\r\n\r\nthis.displayMe = () => {\r\n  this.windDirWrapperElem.classList.remove('hide');\r\n}\r\n\r\nconst varElem = document.querySelector(`.${winDirWrapperName}`);\r\nconst winVelocityElem = document.querySelector(`.${winVelocityName}>span`);\r\n\r\nthis.angle = 0;\r\nthis.adjustAngle = 0;\r\nthis.trackId = '';\r\nthis.trackWindVelocity = -1;",
    "dispose": "this.trackMapElem.removeChild(this.windDirWrapperElem);",
    "flush": "",
    "update": "const angle = Math.round(rawData.trackWindDirection * 180 / Math.PI) - this.adjustAngle;\r\nconst trackWindVelocity = Math.round(rawData.trackWindVelocity);\r\n\r\nif (this.trackId !== rawData.trackId) {\r\n  console.debug(`circuit name: ${rawData.trackDisplayName}, trackId: ${rawData.trackId}`);\r\n  if (this.trackInfos[rawData.trackId] != null) { // includes undefined\r\n    this.adjustAngle = this.trackInfos[rawData.trackId]\r\n    this.displayMe();\r\n  } else {\r\n    console.error(`This track is not defined. You need to define trackId ${rawData.trackId} to this.trackInfos`);\r\n    this.hideMe();\r\n  }\r\n  this.trackId = rawData.trackId;\r\n}\r\n\r\nif (this.trackWindVelocity !== trackWindVelocity) {\r\n    console.debug(`trackWindVelocity: ${trackWindVelocity}`);\r\n    this.setTrackWindVelocity(trackWindVelocity);\r\n    this.trackWindVelocity = trackWindVelocity;\r\n}\r\n\r\nif (parseInt(angle) !== parseInt(this.angle)) {\r\n  this.setAngle(angle)\r\n  console.debug(`angle: ${angle}`);\r\n  console.debug(`this.angle: ${this.angle}`);\r\n  console.debug(`adjustAngle: ${this.adjustAngle}`);\r\n}\r\n/*\r\nconsole.debug(`trackName: ${rawData.trackName}`);\r\nconsole.debug(`trackConfigurationName: ${rawData.trackConfigurationName}`);\r\nconsole.debug(`trackId: ${rawData.trackId}`);\r\n*/\r\n"
  }
]